#!/bin/bash
apt update
apt upgrade -y
apt install default-jre  git -y
git clone https://github.com/dr-mato/minecraft_server.git
FILE_USERDATA="/var/lib/cloud/seed/nocloud-net/user-data"
echo "set cloud-init/datasources NoCloud" | debconf-communicate
mkdir -p /etc/cloud/cloud.cfg.d /var/lib/cloud/seed/nocloud-net
cat > /etc/cloud/cloud.cfg.d/99-warnings.cfg <<'EOS'
#cloud-config
warnings:
  dsid_missing_source: off
EOS
UMASK=$(umask)
umask 0066
echo "Creating $FILE_USERDATA..."
touch "${FILE_USERDATA}"
cat ./minecraft_server/app/cloud-config.yml > "${FILE_USERDATA}"
umask "${UMASK}"
apt-get -q=2 update
apt-get -q=2 install -y cloud-init
cloud-init init
cloud-init modules --mode=config
cloud-init modules --mode=final